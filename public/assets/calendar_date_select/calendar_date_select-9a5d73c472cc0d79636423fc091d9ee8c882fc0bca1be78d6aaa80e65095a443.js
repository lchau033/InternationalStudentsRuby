"undefined"==typeof Prototype&&alert("CalendarDateSelect Error: Prototype could not be found. Please make sure that your application's layout includes prototype.js (.g. <%= javascript_include_tag :defaults %>) *before* it includes calendar_date_select.js (.g. <%= calendar_date_select_includes %>)."),Prototype.Version<"1.6"&&alert("Prototype 1.6.0 is required.  If using earlier version of prototype, please use calendar_date_select version 1.8.3"),Element.addMethods({purgeChildren:function(e){$A(e.childNodes).each(function(e){$(e).remove()})},build:function(e,t,i,n){var s=Element.buildAndAppend(t,i,n);return e.appendChild(s),s}}),Element.buildAndAppend=function(e,t,i){var n=$(document.createElement(e));return $H(t).each(function(e){n[e.key]=e.value}),i&&n.setStyle(i),n},nil=null,Date.one_day=864e5,Date.weekdays=$w("S M T W T F S"),Date.first_day_of_week=0,Date.months=$w("January February March April May June July August September October November December"),Date.padded2=function(e){var t=parseInt(e,10);return e<10&&(t="0"+t),t},Date.prototype.getPaddedMinutes=function(){return Date.padded2(this.getMinutes())},Date.prototype.getAMPMHour=function(){var e=this.getHours();return 0==e?12:e>12?e-12:e},Date.prototype.getAMPM=function(){return this.getHours()<12?"AM":"PM"},Date.prototype.stripTime=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())},Date.prototype.daysDistance=function(e){return Math.round((e-this)/Date.one_day)},Date.prototype.toFormattedString=function(e){var t;return t=Date.months[this.getMonth()]+" "+this.getDate()+", "+this.getFullYear(),e&&(this.getHours(),t+=" "+this.getAMPMHour()+":"+this.getPaddedMinutes()+" "+this.getAMPM()),t},Date.parseFormattedString=function(e){return new Date(e)},Math.floor_to_interval=function(e,t){return Math.floor(e/t)*t},window.f_height=function(){return[window.innerHeight?window.innerHeight:null,document.documentElement?document.documentElement.clientHeight:null,document.body?document.body.clientHeight:null].select(function(e){return e>0}).first()||0},window.f_scrollTop=function(){return[window.pageYOffset?window.pageYOffset:null,document.documentElement?document.documentElement.scrollTop:null,document.body?document.body.scrollTop:null].select(function(e){return e>0}).first()||0},_translations={OK:"OK",Now:"Now",Today:"Today",Clear:"Clear"},SelectBox=Class.create(),SelectBox.prototype={initialize:function(e,t,i,n){this.element=$(e).build("select",i,n),this.populate(t)},populate:function(e){this.element.purgeChildren();var t=this;$A(e).each(function(e){"object"!=typeof e&&(e=[e,e]),t.element.build("option",{value:e[1],innerHTML:e[0]})})},setValue:function(e){var t=this.element,i=!1;return $R(0,t.options.length-1).each(function(n){t.options[n].value==e.toString()&&(t.selectedIndex=n,i=!0)}),i},getValue:function(){return $F(this.element)}},CalendarDateSelect=Class.create(),CalendarDateSelect.prototype={initialize:function(e,t){if(this.target_element=$(e),!this.target_element)return alert("Target element "+e+" not found!"),!1;"INPUT"!=this.target_element.tagName&&(this.target_element=this.target_element.down("INPUT")),this.target_element.calendar_date_select=this,this.last_click_at=0,this.options=$H({embedded:!1,popup:nil,time:!1,buttons:!0,clear_button:!0,year_range:10,close_on_click:nil,minute_interval:5,popup_by:this.target_element,month_year:"dropdowns",onchange:function(e){return function(){if(e.dispatchEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),e.dispatchEvent(t)}else{var t=document.createEventObject();t.type="onChange",e.fireEvent("onChange",t)}}}(this.target_element),valid_date_check:nil}).merge(t||{}),this.use_time=this.options.get("time"),this.parseDate(),this.callback("before_show"),this.initCalendarDiv(),this.options.get("embedded")||(this.positionCalendarDiv(),Event.observe(document,"mousedown",this.closeIfClickedOut_handler=this.closeIfClickedOut.bindAsEventListener(this)),Event.observe(document,"keypress",this.keyPress_handler=this.keyPress.bindAsEventListener(this))),this.callback("after_show")},positionCalendarDiv:function(){var e=!1,t=this.calendar_div.cumulativeOffset(),i=(t[0],t[1],this.calendar_div.getDimensions()),n=i.height,s=i.width,a=window.f_scrollTop(),o=window.f_height(),r=$(this.options.get("popup_by")).cumulativeOffset(),l=r[1],d=r[0],h=$(this.options.get("popup_by")).getDimensions().height,c=l+h;c+n>a+o&&c-n>a&&(e=!0);var u=d.toString()+"px",_=(e?l-n:l+h).toString()+"px";this.calendar_div.style.left=u,this.calendar_div.style.top=_,this.calendar_div.setStyle({visibility:""}),"Microsoft Internet Explorer"==navigator.appName&&(this.iframe=$(document.body).build("iframe",{src:"javascript:false",className:"ie6_blocker"},{left:u,top:_,height:n.toString()+"px",width:s.toString()+"px",border:"0px"}))},initCalendarDiv:function(){if(this.options.get("embedded"))var parent=this.target_element.parentNode,style={};else var parent=document.body,style={position:"absolute",visibility:"hidden",left:0,top:0};this.calendar_div=$(parent).build("div",{className:"calendar_date_select"},style);var that=this;$w("top header body buttons footer bottom").each(function(name){eval("var "+name+"_div = that."+name+"_div = that.calendar_div.build('div', { className: 'cds_"+name+"' }, { clear: 'left'} ); ")}),this.initHeaderDiv(),this.initButtonsDiv(),this.initCalendarGrid(),this.updateFooter("&#160;"),this.refresh(),this.setUseTime(this.use_time)},initHeaderDiv:function(){var e=this.header_div;this.close_button=e.build("a",{innerHTML:"x",href:"#",onclick:function(){return this.close(),!1}.bindAsEventListener(this),className:"close"}),this.next_month_button=e.build("a",{innerHTML:"&gt;",href:"#",onclick:function(){return this.navMonth(this.date.getMonth()+1),!1}.bindAsEventListener(this),className:"next"}),this.prev_month_button=e.build("a",{innerHTML:"&lt;",href:"#",onclick:function(){return this.navMonth(this.date.getMonth()-1),!1}.bindAsEventListener(this),className:"prev"}),"dropdowns"==this.options.get("month_year")?(this.month_select=new SelectBox(e,$R(0,11).map(function(e){return[Date.months[e],e]}),{className:"month",onchange:function(){this.navMonth(this.month_select.getValue())}.bindAsEventListener(this)}),this.year_select=new SelectBox(e,[],{className:"year",onchange:function(){this.navYear(this.year_select.getValue())}.bindAsEventListener(this)}),this.populateYearRange()):this.month_year_label=e.build("span")},initCalendarGrid:function(){var e=this.body_div;this.calendar_day_grid=[];var t=e.build("table",{cellPadding:"0px",cellSpacing:"0px",width:"100%"}),i=t.build("thead").build("tr");Date.weekdays.each(function(e){i.build("th",{innerHTML:e})});for(var n,s=t.build("tbody"),a=0,o=0;o<42;o++)n=(o+Date.first_day_of_week)%7,o%7==0&&(days_row=s.build("tr",{className:"row_"+a++})),(this.calendar_day_grid[o]=days_row.build("td",{calendar_date_select:this,onmouseover:function(){this.calendar_date_select.dayHover(this)},onmouseout:function(){this.calendar_date_select.dayHoverOut(this)},onclick:function(){this.calendar_date_select.updateSelectedDate(this,!0)},className:0==n||6==n?" weekend":""},{cursor:"pointer"})).build("div"),this.calendar_day_grid[o]},initButtonsDiv:function(){var e=this.buttons_div;if(this.options.get("time")){var t=$A("mixed"==this.options.get("time")?[[" - ",""]]:[]);e.build("span",{innerHTML:"@",className:"at_sign"});var i=new Date;this.hour_select=new SelectBox(e,t.concat($R(0,23).map(function(e){return i.setHours(e),$A([i.getAMPMHour()+" "+i.getAMPM(),e])})),{calendar_date_select:this,onchange:function(){this.calendar_date_select.updateSelectedDate({hour:this.value})},className:"hour"}),e.build("span",{innerHTML:":",className:"seperator"});var n=this;this.minute_select=new SelectBox(e,t.concat($R(0,59).select(function(e){return e%n.options.get("minute_interval")==0}).map(function(e){return $A([Date.padded2(e),e])})),{calendar_date_select:this,onchange:function(){this.calendar_date_select.updateSelectedDate({minute:this.value})},className:"minute"})}else this.options.get("buttons")||e.remove();this.options.get("buttons")&&(e.build("span",{innerHTML:"&#160;"}),"mixed"!=this.options.get("time")&&this.options.get("time")||(b=e.build("a",{innerHTML:_translations.Today,href:"#",onclick:function(){return this.today(!1),!1}.bindAsEventListener(this)})),"mixed"==this.options.get("time")&&e.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"}),this.options.get("time")&&(b=e.build("a",{innerHTML:_translations.Now,href:"#",onclick:function(){return this.today(!0),!1}.bindAsEventListener(this)})),this.options.get("embedded")||this.closeOnClick()||(e.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"}),e.build("a",{innerHTML:_translations.OK,href:"#",onclick:function(){return this.close(),!1}.bindAsEventListener(this)})),this.options.get("clear_button")&&(e.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"}),e.build("a",{innerHTML:_translations.Clear,href:"#",onclick:function(){return this.clearDate(),this.options.get("embedded")||this.close(),!1}.bindAsEventListener(this)})))},refresh:function(){this.refreshMonthYear(),this.refreshCalendarGrid(),this.setSelectedClass(),this.updateFooter()},refreshCalendarGrid:function(){this.beginning_date=new Date(this.date).stripTime(),this.beginning_date.setDate(1),this.beginning_date.setHours(12);var e=this.beginning_date.getDay();e<3&&(e+=7),this.beginning_date.setDate(1-e+Date.first_day_of_week);var t=new Date(this.beginning_date),i=(new Date).stripTime(),n=this.date.getMonth();vdc=this.options.get("valid_date_check");for(var s=0;s<42;s++)day=t.getDate(),month=t.getMonth(),cell=this.calendar_day_grid[s],Element.remove(cell.childNodes[0]),div=cell.build("div",{innerHTML:day}),month!=n&&(div.className="other"),cell.day=day,cell.month=month,cell.year=t.getFullYear(),vdc&&(vdc(t.stripTime())?cell.removeClassName("disabled"):cell.addClassName("disabled")),t.setDate(day+1);this.today_cell&&this.today_cell.removeClassName("today"),$R(0,41).include(days_until=this.beginning_date.stripTime().daysDistance(i))&&(this.today_cell=this.calendar_day_grid[days_until],this.today_cell.addClassName("today"))},refreshMonthYear:function(){var e=this.date.getMonth(),t=this.date.getFullYear();if("dropdowns"==this.options.get("month_year")){this.month_select.setValue(e,!1);var i=this.year_select.element;this.flexibleYearRange()&&(!this.year_select.setValue(t,!1)||i.selectedIndex<=1||i.selectedIndex>=i.options.length-2)&&this.populateYearRange(),this.year_select.setValue(t)}else this.month_year_label.update().insert(Date.months[e]+" "+t.toString())},populateYearRange:function(){this.year_select.populate(this.yearRange().toArray())},yearRange:function(){if(!this.flexibleYearRange())return $R(this.options.get("year_range")[0],this.options.get("year_range")[1]);var e=this.date.getFullYear();return $R(e-this.options.get("year_range"),e+this.options.get("year_range"))},flexibleYearRange:function(){return"number"==typeof this.options.get("year_range")},validYear:function(e){return!!this.flexibleYearRange()||this.yearRange().include(e)},dayHover:function(e){var t=new Date(this.selected_date);t.setFullYear(e.year,e.month,e.day),this.updateFooter(t.toFormattedString(this.use_time))},dayHoverOut:function(){this.updateFooter()},clearSelectedClass:function(){this.selected_cell&&this.selected_cell.removeClassName("selected")},setSelectedClass:function(){this.selection_made&&(this.clearSelectedClass(),$R(0,42).include(days_until=this.beginning_date.stripTime().daysDistance(this.selected_date.stripTime()))&&(this.selected_cell=this.calendar_day_grid[days_until],this.selected_cell.addClassName("selected")))},reparse:function(){this.parseDate(),this.refresh()},dateString:function(){return this.selection_made?this.selected_date.toFormattedString(this.use_time):"&#160;"},parseDate:function(){var e=$F(this.target_element).strip(),t=this.options.get("default_time");this.selection_made=""!=e||t,this.date=""==e?NaN:Date.parseFormattedString(this.options.get("date")||e),isNaN(this.date)&&!t?this.date=new Date:isNaN(this.date)&&t&&(this.date="[object Function]"===Object.prototype.toString.apply(t)?t():t),this.validYear(this.date.getFullYear())||this.date.setYear(this.date.getFullYear()<this.yearRange().start?this.yearRange().start:this.yearRange().end),this.selected_date=new Date(this.date),this.use_time=!!/[0-9]:[0-9]{2}/.exec(e),this.date.setDate(1)},updateFooter:function(e){e||(e=this.dateString()),this.footer_div.purgeChildren(),this.footer_div.build("span",{innerHTML:e})},clearDate:function(){if((this.target_element.disabled||this.target_element.readOnly)&&"force"!=this.options.get("popup"))return!1;var e=this.target_element.value;this.target_element.value="",this.clearSelectedClass(),this.updateFooter("&#160;"),e!=this.target_element.value&&this.callback("onchange")},updateSelectedDate:function(e,t){var i=$H(e);if((this.target_element.disabled||this.target_element.readOnly)&&"force"!=this.options.get("popup"))return!1;if(i.get("day")){var n=this.selected_date,s=this.options.get("valid_date_check");if(n.setFullYear(i.get("year"),i.get("month"),i.get("day")),s&&!s(n.stripTime()))return!1;this.selected_date=n,this.selection_made=!0}isNaN(i.get("hour"))||this.selected_date.setHours(i.get("hour")),isNaN(i.get("minute"))||this.selected_date.setMinutes(Math.floor_to_interval(i.get("minute"),this.options.get("minute_interval"))),""===i.get("hour")||""===i.get("minute")?this.setUseTime(!1):isNaN(i.get("hour"))&&isNaN(i.get("minute"))||this.setUseTime(!0),this.updateFooter(),this.setSelectedClass(),this.selection_made&&this.updateValue(),this.closeOnClick()&&this.close(),t&&!this.options.get("embedded")&&(new Date-this.last_click_at<333&&this.close(),this.last_click_at=new Date)},closeOnClick:function(){return!this.options.get("embedded")&&(this.options.get("close_on_click")===nil?!this.options.get("time"):this.options.get("close_on_click"))},navMonth:function(e){return(target_date=new Date(this.date)).setMonth(e),this.navTo(target_date)},navYear:function(e){return(target_date=new Date(this.date)).setYear(e),this.navTo(target_date)},navTo:function(e){return!!this.validYear(e.getFullYear())&&(this.date=e,this.date.setDate(1),this.refresh(),this.callback("after_navigate",this.date),!0)},setUseTime:function(e){if(this.use_time=this.options.get("time")&&("mixed"!=this.options.get("time")||e),this.use_time&&this.selected_date){var t=Math.floor_to_interval(this.selected_date.getMinutes(),this.options.get("minute_interval")),i=this.selected_date.getHours();this.hour_select.setValue(i),this.minute_select.setValue(t)}else"mixed"==this.options.get("time")&&(this.hour_select.setValue(""),this.minute_select.setValue(""))},updateValue:function(){var e=this.target_element.value;this.target_element.value=this.dateString(),e!=this.target_element.value&&this.callback("onchange")},today:function(e){var t=new Date;this.date=new Date;var i=$H({day:t.getDate(),month:t.getMonth(),year:t.getFullYear(),hour:t.getHours(),minute:t.getMinutes()});e||(i=i.merge({hour:"",minute:""})),this.updateSelectedDate(i,!0),this.refresh()},close:function(){if(this.closed)return!1;this.callback("before_close"),this.target_element.calendar_date_select=nil,Event.stopObserving(document,"mousedown",this.closeIfClickedOut_handler),Event.stopObserving(document,"keypress",this.keyPress_handler),this.calendar_div.remove(),this.closed=!0,this.iframe&&this.iframe.remove(),"hidden"==this.target_element.type||this.target_element.disabled||this.target_element.focus(),this.callback("after_close")},closeIfClickedOut:function(e){$(Event.element(e)).descendantOf(this.calendar_div)||this.close()},keyPress:function(e){e.keyCode==Event.KEY_ESC&&this.close()},callback:function(e,t){this.options.get(e)&&this.options.get(e).bind(this.target_element)(t)}};